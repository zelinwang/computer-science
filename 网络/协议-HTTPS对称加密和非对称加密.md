## 一、概念

**对称加密：**是指用单个密钥来加密和解密数据，通俗来讲加密和解密都使用同一个秘钥; 

> 对称加密有很多种算法，由于它效率很高，所以被广泛使用在很多加密协议的核心当中。对称加密通常使用的是相对较小的密钥，一般小于256 bit。因为密钥越大，加密越强，但加密与解密的过程越慢。如果你只用1 bit来做这个密钥，那黑客们可以先试着用0来解密，不行的话就再用1解；但如果你的密钥有1 MB大，黑客们可能永远也无法破解，但加密和解密的过程要花费很长的时间。密钥的大小既要照顾到安全性，也要照顾到效率，是一个trade-off。

**非对称加密：**是由公钥和私钥两个秘钥组成的，称为密钥对。

> 非对称密钥加密，它需要使用“一对”密钥来分别完成加密和解密操作，一个公开发布，即公开密钥，另一个由用户自己秘密保存，即私用密钥。信息发送者用公开密钥去加密，而信息接收者则用私用密钥去解密。公钥机制灵活，但加密和解密速度却比对称密钥加密慢得多。
>
> 非对称密钥加密的使用过程：
> 1. A要向B发送信息，A和B都要产生一对用于加密和解密的公钥和私钥。
> 2. A的私钥保密，A的公钥告诉B；B的私钥保密，B的公钥告诉A。
> 3. A要给B发送信息时，A用B的公钥加密信息，因为A知道B的公钥。
> 4. A将这个消息发给B（已经用B的公钥加密消息）。
> 5. B收到这个消息后，B用自己的私钥解密A的消息，其他所有收到这个报文的人都无法解密，因为只有B才有B的私钥。
> 6. 反过来，B向A发送消息也是一样。
>
> 非对称加密算法：
>
> 1. DH
>
>    > 非对称算法的基石
>    > 仅能用于密钥分配，不能用于加解密数据，一般加密数据用AES
>    > 密钥长度：512~1024中的64的整数倍
>    > 双方各有自己的密钥对
>
> 2. RSA
>
>    > 最经典的非对称加密算法
>    > 也可认为是使用最多的非对称加密算法
>    > 能用于密钥分配，也能用于加解密数据（“私钥加密，公钥解密”和“公钥加密，私钥解密”）
>    > 密钥长度：512~65536（64的整数倍）
>    > 只有发送方有一个密钥对，或者更安全的做法是：双发均生成自己的密钥对，但是后边使用密钥对进行加解密时与DH的区别查看前一章
>    > 可用于数字签名
>
> 3. ElGamal
>
>    > 数字签名DSA的基础
>    > 具体实现方式只有BC有，与RSA的实现方式类似
>    > 只有“公钥加密，私钥加密”方式（公钥加密实际上安全性不高）
>    > 密文会成倍扩张

## 二、区别

1. 对称加密加密与解密使用的是同样的密钥，所以速度快，但由于需要将密钥在网络传输，所以安全性不高。
2. 非对称加密使用了一对密钥，公钥与私钥，所以安全性高，但加密与解密速度慢。
3. 解决的办法是将对称加密的密钥使用非对称加密的公钥进行加密，然后发送出去，接收方使用私钥进行解密得到对称加密的密钥，然后双方可以使用对称加密来进行沟通。

## 四、过程

HTTPS数据加解密过程中数据进行对称加密，对称加密所要使用的密钥通过非对称加密传输。HTTPS协议加密的过程可以分为两个阶段，分别是：

- 证书的认证阶段：使用非对称加解密算法对数据传送阶段的对称加解密密钥进行加密和解密。
- 数据传送阶段：通过证书认证阶段获取到目标服务器的对称加解密密钥，对数据进行加密传送给服务器。

HTTPS为了兼顾安全与效率，同时使用了对称加密和非对称加密。数据是被对称加密传输的，对称加密过程需要客户端的一个密钥，为了确保能把该密钥安全传输到服务器端，采用非对称加密对该密钥进行加密传输。总的来说，**对数据进行对称加密，对称加密所要使用的密钥通过非对称加密传输**。

在整个HTTPS数据传输的过程中一共会涉及到四个密钥：

1. CA机构的公钥，用来验证数字证书是否可信任
2. 服务器端的公钥
3. 服务器端的私钥
4. 客户端生成的随机密钥

一个HTTPS请求可以分为两个阶段，证书认证阶段和数据传送阶段。又可以细分为六个步骤：

1. 客户端第一次向服务器发起HTTPS请求，连接到服务器的443（默认）端口。
2. 服务器端有一个密钥对，公钥和私钥。用来进行非对称加密使用，服务器端保存私钥，不能泄露，公钥可以发送给任何人。服务器将自己的数字证书（包含公钥）发送给客户端。
3. 客户端收到服务器端的数字证书之后，会对数字证书进行检查，验证合法性。如果发现数字证书有问题，那么HTTPS传输就中断。如果数字证书合格，那么客户端生成一个随机值，这个随机值是数据传输阶段时给数据对称加密的密钥，然后用数字证书中的公钥加密这个随机值密钥，这样就生成了加密数据使用的密钥的密文。到这时，HTTPS中的第一次HTTP请求就结束了。
4. 客户端第二次向服务器发起HTTP请求，将对称加密密钥的密文发送给服务器。
5. 服务器接收到客户端发来的密文之后，通过使用非对称加密中的私钥解密密文，得到数据传送阶段使用的对称加密密钥。然后对需要返回给客户端的数据通过这个对称加密密钥加密，生成数据密文，最后将这个密文发送给客户端。
6. 客户端收到服务器端发送过来的密文，通过本地密钥对密文进行解密，得到数据明文。到这时，HTTPS中的第二次HTTP请求结束，整个HTTPS传输完成。