## 一、概述

C++ 11 中的 Lambda 表达式用于定义并创建匿名的函数对象，以简化编程工作

Lambda 的语法形式如下：

```
[函数对象参数] (操作符重载函数参数) mutable 或 exception 声明 -> 返回值类型 {函数体}
```

可以看到，Lambda 主要分为五个部分：[函数对象参数]、(操作符重载函数参数)、mutable 或 exception 声明、-> 返回值类型、{函数体}

## 二、 Lambda 语法分析

### 1、 [函数对象参数]

​		标识一个 Lambda 表达式的开始，这部分必须存在，不能省略。函数对象参数是传递给编译器自动生成的函数对象类的构造函数。函数对象参数只能使用那些到定义 Lambda 为止时 Lambda 所在作用范围内可见的局部变量(包括 Lambda 所在类的 this)。函数对象参数有以下形式：

| **捕捉列表** |                    **说明**                    |
| :----------: | :--------------------------------------------: |
|   [变量名]   |             值传递的方式捕获某变量             |
|     [=]      |  值传递的方法捕获父作用域的所有变量(包括this)  |
|  [&变量名]   |            引用传递的方式捕获某变量            |
|     [=]      | 引用传递的方法捕获父作用域的所有变量(包括this) |
|    [this]    |         值传递的当值捕获当前的this指针         |

### 2、 (操作符重载函数参数)

​		标识重载的 () 操作符的参数，没有参数时，这部分可以省略。参数可以通过按值（如: (a, b)）和按引用 (如: (&a, &b)) 两种方式进行传递。

### 3、mutable 或 exception 声明

​		这部分可以省略。按值传递函数对象参数时，加上 mutable 修饰符后，可以修改传递进来的拷贝（注意是能修改拷贝，而不是值本身）。exception 声明用于指定函数抛出的异常，如抛出整数类型的异常，可以使用 throw(int)。

### 4、 -> 返回值类型

​		标识函数返回值的类型，当返回值为 void，或者函数体中只有一处 return 的地方（此时编译器可以自动推断出返回值类型）时，这部分可以省略。

### 5、 {函数体}

标识函数的实现，这部分不能省略，但函数体可以为空。

## 三、底层实现原理

lambda编译完之后，所在汇编中的代码实现，和**仿函数**一致。

### 1、没有捕获变量的lambda表达式

编译器为我们了创建了一个类，并且重载了()，调用过程中像调用函数一样使用。lambda表达式的实现如下

```c++
//[](X& x)->void{}  lambda表达式

class A
{
public:
	void operator() (X& x)
	{
		//...
	}
}
```

### 2、捕获变量的lambda表达式

编译器在创建类的时候，通过成员函数的形式保存了需要捕获的变量，lambda表达式的实现如下

```c++
//[&a, *b, c](X& x)->void{}  lambda表达式

class A
{
public:
	A(int& a, int* b, int c): _a(a), _b(b), _c(c){}
	void operator() (X& x, )
	{
		//...
	}
private:
	int& _a;
	int* _b;
	int _c;
}
```

