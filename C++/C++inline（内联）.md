## 一、目的

在C++中， 为了解决一些频繁调用的小函数大量消耗栈空间（栈内存）的问题，特别的引入了inline修饰符，表示为内联函数。作为函数定义的关键字，说明该函数是内联函数。内联函数会将代码块嵌入到每个调用该函数的地方。内联函数减少了函数的调用，使代码执行的效力提高，但是会增加目标代码的大小，最终会使程序的代码段占有大量的内存。（**栈空间**，指放置程序的局部数据也就是函数内数据的内存空间，在系统下，栈空间是有限的，如果频繁大量的使用就会造成因栈空间不足所造成的程序出错的问题，函数的死循环递归调用的最终结果就是导致栈内存空间枯竭）。

**常规函数与内联函数的最主要区别不在于编写方式，而在于函数代码如何组合到程序当中**

## 二、实现

要使用inline的特性，有两种方式

1、在函数声明前加上关键字inline

2、在函数定义前加上关键字inline

inline函数对编译器而言必须是可见的，以便它能够在调用点内展开该函数。与非inline函数不同的是，inline函数必须在调用该函数的每个文本文件中定义。当然，对于同一程序的不同文件，如果C++inline函数出现的话，其定义必须相同。对于由两个文件compute.C和draw.C构成的程序来说，程序员不能定义这样的min()函数，它在compute.C中指一件事情，而在draw.C中指另外一件事情。如果两个定义不相同，程序将会有未定义的行为：

为保证不会发生这样的事情，建议把inline函数的定义放到头文件中。在每个调用该inline函数的文件中包含该头文件。这种方法保证对每个inline函数只有一个定义，且程序员无需复制代码，并且不可能在程序的生命期中引起无意的不匹配的事情。

关键字inline 必须与函数定义体放在一起才能使函数成为内联，仅将inline放在函数声明前面不起任何作用

Inline不是强制的，编译器可以对它置之不理。例如，递归函数通常不会被编译为inline函数，编译器有权决定是否将声明为inline的函数编译为inline.

GCC编译器，如果使用了-O3选项，一些代码量小的函数会转换为inline处理，即使这个函数没有使用inline来声明。

强制不内联：使用标示符(noinline)，如：void fun() __attribute__((noinlne));

将实现的这个函数写到调用函数之后，就不会被强制转换为inline了。因为编译器gcc只强制内联当前函数之前可见(实现代码在前)的函数。



### 一）内联函数的编程风格

1. 隐喻式：定义在类中的成员函数缺省都是内联的，如果在类定义时就在类内给出函数定义，那当然最好。

   ```
   class A
   {
   public:
   	A():__Value(0){}
       void setValue(int value) {_Value = value;} // 自动地成为内联函数
   private:
       int _Value;
   }
   ```

2. 明确声明：如果在类中未给出成员函数定义，而又想内联该函数的话，那在类外要加上inline，否则就认为不是内联的

   ```
   //头文件 *.h
   class A
   {
   public:
   	A():__Value(0){}
       void setValue(int value);
   private:
       int _Value;
   }
   
    //源文件 *.cpp
    inline void A::setValue(int value){_Value = value;}
   ```


## 三、使用条件

inline的使用是有所限制的，inline只适合逻辑简单的函数示用，如设置一个值，返回一个值，常规的加减乘除用法等。

### 一）不能使用inline的函数

1. 内联函数不能递归
2. 不能包含复杂的结构控制语句例如while、switch
3. 虚函数/纯虚函数不能内联
4. 函数体内的代码比较长(使用内联将导致内存消耗代价较高)
5. 构造函数和析构函数

## 四、内联与宏定义

内联函数与宏定义有着相似的地方，比如都是将代码进行了替换，那么有了宏为什么还有了内联。

### 一）区别

1. 内联函数在编译期进行展开，宏定义在预编译期进行文本替换；
2. 内联函数是将代码直接嵌入，宏只是简单的文本替换；
3. 内联函数有语法判断，类型检测等功能，而宏没有；
4. inline是函数，宏定义不是；
5. 宏定义要注意语法歧义，内联函数不会；

### 二）内联的优点

1. 内联函数代码是被放在符号表中的，使用时想宏一样展开，没有调用开销，效率高；
2. 内联函数是函数，有类型检测，是安全的；
3. 内联函数作为类的成员函数，可以使用类的保护及私有成员；

