## 信号简介

软中断信号 (简称为信号) 是用来通知进程发生了异步事件，是在软件层次上是对中断机制的一种模拟，在原理上，一个进程收到一个信号与处理器收到一个中断请求可以说是一样的。

信号是**进程间通信机制中唯一的异步通信机制**，一个进程不必通过任何操作来等待信号的到达，事实上，进程也不知道信号到底什么时候到达。

## 信号的功能

最简单的理解，在linux下我们在运行某个进程的时候，通常在shell下启动一个前台进程，但是我们进程运行过程中我们，按下Ctrl+C，这个时候我们的进程就会停止或者说结束。其实，这就是信号起了作用，在我们按下Ctrl+c的时候，将会产生硬件中断，从而CPU转到内核去处理中处理，同时终端会将Ctrl+C被解析成一个SIGINT信号，发送给进程PBC，这个时候PCB中的会被记录下一个SIGINT信号，当某个时候cup从内核切回到用户空间时候，所以会处理这个进行中记录的信号，而这个信号的默认处理动作是结束进程。

后来 Linux 改进了信号机制，增加了 32 种新的信号，这些信号都是可靠信号，支持排队，主要位于 [SIGRTMIN, SIGRTMAX] 区间，通常用于用户使用。

对于信号，通常有如下的几种处理方式：

1. 忽略。大部分信号都可以通过这种方式处理，不过 SIGKILL 和 SIGSTOP 两个信号有特殊用处，不能被忽略。
2. 默认动作。大多数信号的系统默认动作终止该进程。
3. 捕捉信号。也就是在收到信号时，执行一些用户自定义的函数。

## 信号处理过程

进程收到一个信号后不会被立即处理，而是在恰当时机进行处理！一般是在**中断返回的时候**，或者**内核态返回用户态**的时候 (这个情况出现的比较多)。

也就是说，信号不一定会被立即处理，操作系统不会为了处理一个信号而把当前正在运行的进程挂起，因为这样的话资源消耗太大了，如果不是紧急信号，是不会立即处理的，操作系统多选择在内核态切换回用户态的时候处理信号。

因为进程有可能在睡眠的时候收到信号，操作系统肯定不愿意切换当前正在运行的进程，于是就得把信号储存在进程唯一的PCB(task_struct) 当中。

## 信号的产生

### 键盘按键产生信号

### 调用系统函数

### 软件产生信号

### 硬件异常产生信号

## 信号的阻塞，未决，忽略

当一个进程收到一个信号的时候，信号其实是先到该进程中的PCB中找到一个表，我们就叫未决信号表，其实是二进制表示的位图，然后将该信号对应的bit位置1，表示有信号到来，接下来就是处理该信号，进程会查看阻塞信号表是否对应的bit位置1，如果没有，则进行上面说的信号处理过程，如果置1，则不进行处理，直到进程解除此信号的阻塞。

- 未决的意思就是还没有执行，但是已经置bit位，需要在合适时机去执行。
- 忽略好理解，就是产生信号直接丢掉，等同于没有信号产生。
- 阻塞 (block)， 如果一个信号被设置为阻塞，进程收到信号不处理，仅仅置未决信号表对应bit位。直到进程解除对此信号的阻塞，只是对阻塞信号表对应bit清0，未决信号表此时仍然有效，接着进行上面说的信号处理过程。
  